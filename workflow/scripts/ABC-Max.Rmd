---
title: "Comparing predictions with common disease variants"
author: "Kristy Mualim" 
date: "04/15/2021"
params:
    rmd: "ABC-Max.Rmd"
output:
    html_document:
        toc: true 
---
<br>

`r snakemake@params$codeDir`

```{r setup, include=FALSE}
# load required functions and packages
library(here)

# set global chunk options
knitr::opts_chunk$set(echo = FALSE)

source(file.path(snakemake@params$codeDir, "PlotCellTypeEnrichment.R"))
source(file.path(snakemake@params$codeDir, "PlotEnrichmentAggregate.R"))
source(file.path(snakemake@params$codeDir, "PlotFractionOverlap.R"))
source(file.path(snakemake@params$codeDir, "PlotGenePrecisionRecall.R"))
source(file.path(snakemake@params$codeDir, "JuicerUtilities.R"))
source(file.path(snakemake@params$codeDir, "CredibleSetTools.R"))
```

This report shows summary statistics produced by the disease variant validation pipeline for pred
**`r snakemake@wildcards$pred`**.
<br>
# Plotting enrichment plots
These barplots calculates the enrichment fine-mapped `r snakemake@wildcards$trait` variants (PIP >= 10%) in `r snakemake@wildcards$pred` enhancers across all  biosamples.
<br>
```{r plottingEnrichmentCode, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotCellTypeEnrichment.R) \
       --outdir here(snakemake@params$indivOutDir) \
       --outPdf test \
       --outEps test \
       --cellTypes here(snakemake@params$cellTypeTable) \
       --cellTypeEnrichments here(snakemake@input$cellTypeEnrichments) \
       --codeDir here(snakemake@params$codeDir) \
       --trait snakemake@wildcards$trait
```
<br>

After removing any enhancer region that overlaps an existing promoter region (promoter regions as defined by `r snakemake@config$genes`). Enrichment calculations are similar to those seen above, with the barplots showing the enrichment fine-mapped `r snakemake@wildcards$trait` variants (PIP >= 10%) in `r snakemake@wildcards$pred` enhancers across all  biosamples.

<br>
```{r plottingEnrichmentCodeforNoPromoters, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotCellTypeEnrichment.R) \
	--outdir here(snakemake@params$indivOutDir) \
	--outPdf test \
  	--outEps test \
	--cellTypes here(snakemake@params$cellTypeTable) \
	--cellTypeEnrichments here(snakemake@input$cellTypeEnrichments) \
	--codeDir here(snakemake@params$codeDir) \
	--trait snakemake@wildcards$trait \
	--entry "enrichment.NoPromoters"
```

These barplots calculates the fraction of `r snakemake@wildcards$trait` variants (PIP >= 10%) that overlap `r snakemake@wildcards$pred` enhancers.
<br>

```{r plottingFractionOverlap, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotFractionOverlap.R) \
	--outdir here(snakemake@params$indivOutDir) \
	--outPdf test \
	--outEps test \
	--cellTypes here(snakemake@params$cellTypeTable) \
	--cellTypeEnrichments here(snakemake@input$cellTypeEnrichments) \
	--codeDir here(snakemake@params$codeDir) \
	--trait snakemake@wildcards$trait 
```
<br>

After removing any enhancer region that overlaps an existing promoter region (promoter regions as defined by `r snakemake@config$genes`). These barplots calculates the fraction of `r snakemake@wildcards$trait` variants (PIP >= 10%) that overlap `r snakemake@wildcards$pred` enhancers.

<br>

```{r plottingFractionOverlapforNoPromoters, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotFractionOverlap.R) \
	--outdir here(snakemake@params$indivOutDir) \
	--outPdf test \
	--outEps test \
	--cellTypes here(snakemake@params$cellTypeTable) \
	--cellTypeEnrichments here(snakemake@input$cellTypeEnrichments) \
	--codeDir here(snakemake@params$codeDir) \
	--trait snakemake@wildcards$trait
	--entry "enrichment.NoPromoters"
```
<br>
Plotting Precision-Recall Curves 

<br>

```{r plotIndividualGenePrecisionRecall, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotGenePrecisionRecall.R) \
	--outPdf test \
	--genePredTable here(snakemake@input$genePredTable) \
	--knownGenes here(snakemake@input$knownGenes) \
	--codeDir here(snakemake@params$codeDir)
```

<br>
Plotting Aggregate Precision-Recall Curves
<br>

```{r plotGenePrecisionRecall, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotGenePrecisionRecall.R) \
	--outPdf test \
	--genePredTable as.String(snakemake@input$allgenePredTable) \
	--knownGenes here(snakemake@input$knownGenes) \
	--codeDir here(snakemake@params$codeDir)
```

<br>
Aggregate Cumulative Density and Density plots across all predictors for enrichment values with all enhancer regions as well as enhancer regions (without promoters)
<br>

```{r plotAggregatecdf, echo=FALSE}
Rscript here(snakemake@params$codeDir/PlotEnrichmentAggregate.R) \
	--names as.String(snakemake@params$predictors) \
	--tables as.String(snakemake@params$enrichmentFiles) \
	--outPdf test \
	--outDensity test \
	--outDir here(snakemake@params$codeDir)
```
